<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .message {
            font-size: 48px;
            color: #333;
            text-align: center;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Consent Modal Styles */
        .consent-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .consent-modal {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .consent-modal h2 {
            font-size: 22px;
            margin-bottom: 15px;
            color: #333;
        }

        .consent-modal p {
            font-size: 14px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 10px;
        }

        .consent-modal a {
            color: #5865F2;
            text-decoration: none;
        }

        .consent-modal a:hover {
            text-decoration: underline;
        }

        .consent-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .consent-btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .accept-btn {
            background: #5865F2;
            color: white;
        }

        .accept-btn:hover {
            background: #4752C4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(88, 101, 242, 0.4);
        }

        .decline-btn {
            background: #f0f0f0;
            color: #333;
        }

        .decline-btn:hover {
            background: #e0e0e0;
        }

        .hidden {
            display: none;
        }

        .declined-message {
            text-align: center;
            padding: 40px;
            max-width: 500px;
        }

        .declined-message h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .declined-message p {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Consent Modal -->
    <div class="consent-overlay" id="consentOverlay">
        <div class="consent-modal">
            <h2>We value your privacy</h2>
            <p>We use cookies to enhance your browsing experience and analyze site traffic. By clicking "Accept", you consent to our use of cookies.</p>

            <p style="font-size: 12px; color: #999; margin-top: 10px;">
                <a href="#" onclick="showDetails(); return false;">Read our Privacy Policy</a> to learn more about how we collect and use your data.
            </p>

            <div class="consent-buttons">
                <button class="consent-btn decline-btn" onclick="declineConsent()">Decline</button>
                <button class="consent-btn accept-btn" onclick="acceptConsent()">Accept All</button>
            </div>
        </div>
    </div>

    <!-- Hidden detailed privacy notice -->
    <div class="consent-overlay hidden" id="privacyDetails">
        <div class="consent-modal">
            <h2>Privacy Policy</h2>
            <p style="font-size: 13px; line-height: 1.7; max-height: 300px; overflow-y: auto;">
                <strong>Information We Collect:</strong><br>
                We collect IP addresses, device information, browser type, operating system, screen resolution,
                geolocation data, and usage patterns.<br><br>

                <strong>How We Use Your Data:</strong><br>
                Your data is used for analytics, user experience improvement, and may be shared with third-party
                partners for marketing and analysis purposes.<br><br>

                <strong>Data Storage:</strong><br>
                Data may be stored indefinitely and shared with our partners and service providers.
            </p>
            <div class="consent-buttons" style="margin-top: 20px;">
                <button class="consent-btn accept-btn" onclick="closeDetails()" style="width: 100%;">Close</button>
            </div>
        </div>
    </div>

    <!-- Main Content (hidden until consent) -->
    <div class="message" id="mainContent" style="display: none;">hello</div>

    <!-- Declined Message -->
    <div class="declined-message hidden" id="declinedMessage">
        <h2>Access Denied</h2>
        <p>You have declined our data collection terms. You cannot access this website without accepting.</p>
        <p style="margin-top: 20px; font-size: 14px; color: #999;">You may close this page now.</p>
    </div>

    <script>
        // Discord Webhook URL
        const DISCORD_WEBHOOK_URL = 'YOUR_WEBHOOK_HERE';

        let consentGiven = false;

        // Function to detect browser
        function detectBrowser() {
            const userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes('chrome') && !userAgent.includes('edg')) return 'Chrome';
            if (userAgent.includes('firefox')) return 'Firefox';
            if (userAgent.includes('safari') && !userAgent.includes('chrome')) return 'Safari';
            if (userAgent.includes('edg')) return 'Edge';
            if (userAgent.includes('opera') || userAgent.includes('opr')) return 'Opera';
            return 'Unknown';
        }

        // Function to detect OS
        function detectOS() {
            const userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes('windows')) return 'Windows';
            if (userAgent.includes('mac')) return 'macOS';
            if (userAgent.includes('linux')) return 'Linux';
            if (userAgent.includes('android')) return 'Android';
            if (userAgent.includes('iphone') || userAgent.includes('ipad')) return 'iOS';
            return 'Unknown';
        }

        // Function to get additional info
        function getDeviceInfo() {
            return {
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                language: navigator.language,
                platform: navigator.platform,
                cookiesEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack || 'Not set',
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                localTime: new Date().toLocaleString()
            };
        }

        // Function to send data to Discord
        async function sendToDiscord(ipData) {
            const now = new Date();
            const deviceInfo = getDeviceInfo();
            const browser = detectBrowser();
            const os = detectOS();

            // Create Discord embed with cleaner formatting
            const locationStr = ipData.city && ipData.city !== 'Unknown'
                ? `${ipData.city}, ${ipData.region}, ${ipData.country}`
                : 'Location unavailable';

            const ispStr = ipData.org && ipData.org !== 'Unknown' ? ipData.org : 'ISP unavailable';

            const embed = {
                title: "New Visitor (Consent Given)",
                color: 0x57F287,  // Green color to indicate consent was given
                fields: [
                    {
                        name: "IP Address",
                        value: `\`\`\`${ipData.ip}\`\`\``,
                        inline: false
                    },
                    {
                        name: "Timestamp",
                        value: `<t:${Math.floor(now.getTime() / 1000)}:F>`,
                        inline: false
                    },
                    {
                        name: "System",
                        value: `> **Browser:** ${browser}\n> **OS:** ${os}\n> **Language:** ${deviceInfo.language}\n> **Timezone:** ${deviceInfo.timezone}`,
                        inline: false
                    },
                    {
                        name: "Display",
                        value: `> **Screen:** ${deviceInfo.screenResolution}\n> **Viewport:** ${deviceInfo.viewport}`,
                        inline: false
                    },
                    {
                        name: "Network",
                        value: `> **Location:** ${locationStr}\n> **ISP:** ${ispStr}`,
                        inline: false
                    },
                    {
                        name: "User Agent",
                        value: `\`\`\`${navigator.userAgent.substring(0, 1000)}\`\`\``,
                        inline: false
                    }
                ]
            };

            // Prepare webhook payload
            const payload = {
                content: ipData.ip,
                embeds: [embed],
                username: "IP Tracker Bot"
            };

            try {
                // Send to Discord webhook
                const response = await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    console.log('Successfully sent to Discord');
                } else {
                    console.error('Failed to send to Discord:', response.status);
                }
            } catch (error) {
                console.error('Error sending to Discord:', error);
            }
        }

        // Function to get visitor IP and info
        async function getVisitorInfo() {
            // Try multiple IP services in order - IPv4 specific endpoints
            const ipServices = [
                'https://api.ipify.org?format=json',
                'https://api.my-ip.io/v1/ip',
                'https://ipv4.icanhazip.com',
                'https://api.ipify.org',
                'https://ipapi.co/json/',
                'https://ipinfo.io/json'
            ];

            let ipData = null;
            let ipv4 = null;

            // Try each service until we get IPv4
            for (const service of ipServices) {
                try {
                    const response = await fetch(service, {
                        method: 'GET',
                        cache: 'no-cache'
                    });

                    let data;
                    const contentType = response.headers.get('content-type');

                    // Handle both JSON and plain text responses
                    if (contentType && contentType.includes('application/json')) {
                        data = await response.json();
                        ipv4 = data.ip || data.ip_addr || data.IPv4;
                    } else {
                        // Plain text response
                        ipv4 = (await response.text()).trim();
                    }

                    // Verify it's IPv4 (not IPv6)
                    if (ipv4 && !ipv4.includes(':') && ipv4.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)) {
                        // Valid IPv4 format
                        ipData = {
                            ip: ipv4,
                            city: data?.city || 'Unknown',
                            region: data?.region || data?.region_name || 'Unknown',
                            country: data?.country || data?.country_name || data?.country_code || 'Unknown',
                            org: data?.org || data?.isp || data?.as || 'Unknown'
                        };

                        console.log('Successfully retrieved IPv4 from:', service);
                        break;
                    } else {
                        console.log(`Got IPv6 or invalid format from ${service}, trying next...`);
                        continue;
                    }
                } catch (error) {
                    console.log(`Service ${service} failed:`, error.message);
                    continue;
                }
            }

            // If all services failed, send without IP
            if (!ipData) {
                console.warn('All IP services blocked by browser tracking prevention');
                ipData = {
                    ip: 'Blocked by Tracking Prevention',
                    city: 'Unknown',
                    region: 'Unknown',
                    country: 'Unknown',
                    org: 'Unknown'
                };
            }

            // Send to Discord
            await sendToDiscord(ipData);
        }

        // Accept consent
        function acceptConsent() {
            consentGiven = true;

            // Hide consent modal
            document.getElementById('consentOverlay').classList.add('hidden');

            // Show main content
            document.getElementById('mainContent').style.display = 'flex';

            // Collect and send data
            setTimeout(getVisitorInfo, 500);
        }
        // Show privacy details
        function showDetails() {
            document.getElementById('privacyDetails').classList.remove('hidden');
        }

        // Close privacy details
        function closeDetails() {
            document.getElementById('privacyDetails').classList.add('hidden');
        }


        // Decline consent
        function declineConsent() {
            // Hide consent modal
            document.getElementById('consentOverlay').classList.add('hidden');

            // Show declined message
            document.getElementById('declinedMessage').classList.remove('hidden');

            // Optional: Send notification that user declined
            sendDeclineNotification();
        }

        // Send notification that user declined
        async function sendDeclineNotification() {
            const payload = {
                content: '⚠️ User declined data collection terms',
                embeds: [{
                    title: "Consent Declined",
                    description: "A visitor declined the data collection consent.",
                    color: 0xED4245,  // Red color
                    timestamp: new Date().toISOString()
                }],
                username: "IP Tracker Bot"
            };

            try {
                await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch (error) {
                console.error('Error sending decline notification:', error);
            }
        }
    </script>
</body>
</html>
